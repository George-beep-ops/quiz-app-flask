{% extends 'base.html' %}

{% block title %}Minispiel 1 – Reaktionsaufgabe{% endblock %}

{% block content %}
  <h2>Wähle innerhalb von <strong>8 Sekunden</strong> zwei Begriffe, die durch Gamification gesteigert werden!</h2>
  <div class="timer">⏳ Zeit läuft... <span id="countdown">8</span></div>

  <form id="gameForm" method="POST">
    <div class="grid">
      <div class="tile" data-word="lernvermögen">lernvermögen</div>
      <div class="tile" data-word="stress">stress</div>
      <div class="tile" data-word="fokussierung">fokussierung</div>
      <div class="tile" data-word="engagement">engagement</div>
    </div>
    <input type="hidden" name="score" id="scoreInput" value="0">
    <button type="submit" style="display: none;">Absenden</button>
  </form>
{% endblock %}

{% block style %}
<style>
  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    max-width: 600px;
    margin: 2rem auto;
  }

  .tile {
    background-color: #eee;
    border-radius: 10px;
    padding: 2rem;
    font-weight: bold;
    font-size: 1.5rem;
    text-align: center;
    cursor: pointer;
    transition: background-color 0.3s ease;
    user-select: none;
  }

  .tile.selected {
    background-color: #7CFC00; /* grün */
    color: white;
  }

  .tile.incorrect {
    background-color: #FF6B6B; /* rot */
    color: white;
  }

  .tile.disabled {
    pointer-events: none;
    opacity: 0.6;
  }

  .timer {
    font-size: 1.3rem;
    font-weight: bold;
    margin-top: 1rem;
  }
</style>
{% endblock %}

{% block script %}
<script>
  const correctWords = ["lernvermögen", "fokussierung", "engagement"];
  const tiles = document.querySelectorAll('.tile');
  const countdownEl = document.getElementById("countdown");
  let selected = [];
  let score = 0;
  let timeLeft = 8;
  let gameEnded = false;

  function endGame() {
    if (gameEnded) return;
    gameEnded = true;
    document.getElementById('scoreInput').value = score;
    tiles.forEach(tile => tile.classList.add('disabled'));
    document.getElementById('gameForm').submit();
  }

  tiles.forEach(tile => {
    tile.addEventListener('click', (e) => {
      e.preventDefault();
      const word = tile.dataset.word;
      if (!selected.includes(word) && selected.length < 2) {
        selected.push(word);
        if (correctWords.includes(word)) {
          tile.classList.add('selected');
          score++;
        } else {
          tile.classList.add('incorrect');
        }
      }
      if (selected.length === 2) {
        clearInterval(timerInterval);
        setTimeout(endGame, 500); // kleines Delay für Farbeffekte
      }
    });
  });

  const timerInterval = setInterval(() => {
    timeLeft--;
    countdownEl.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      endGame();
    }
  }, 1000);
</script>
{% endblock %}




