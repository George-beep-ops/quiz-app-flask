{% extends "base.html" %}

{% block title %}Minispiel 1 – Reaktion{% endblock %}

{% block extra_style %}
<style>
  h2 {
    margin: 1rem;
    font-size: 1.5rem;
    text-align: center;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  .tile {
    background-color: #ddd;
    padding: 1rem;
    width: 140px;
    height: 100px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
    user-select: none;
    text-align: center;
  }
  .tile.selected { background-color: #90ee90; }
  .tile.incorrect { background-color: #ffcccb; }
  .disabled {
    pointer-events: none;
    opacity: 0.5;
  }
  #timer {
    font-size: 1.2rem;
    margin: 1rem;
    font-weight: bold;
  }
</style>
{% endblock %}

{% block content %}
  <h2><strong>Minigame 1 – React!</strong><br>Tap 2 terms within 8 seconds that are <strong>enhanced</strong> through gamification!</h2>

  <form id="gameForm" method="POST" action="{{ url_for('next_step') }}">
    <div class="grid">
      <div class="tile" data-word="option 1">option 1</div>
      <div class="tile" data-word="option 2">option 2</div>
      <div class="tile" data-word="option 3">option 3</div>
      <div class="tile" data-word="option 4">option 4</div>
    </div>
    <input type="hidden" name="score" id="scoreInput" value="0">
    <button type="submit" style="display: none;">Absenden</button>
  </form>

  <div id="timer">⏳ Time is running... 8</div>
{% endblock %}

{% block script %}
<script>
  const correctWords = ["option 1", "option 2", "option 3"];
  let score = 0;
  let selectedCount = 0;
  const tiles = document.querySelectorAll(".tile");

  tiles.forEach(tile => {
    tile.addEventListener("click", () => {
      if (tile.classList.contains("selected") || tile.classList.contains("incorrect")) return;
      if (selectedCount >= 2) return;

      const word = tile.dataset.word;
      if (correctWords.includes(word)) {
        tile.classList.add("selected");
        score++;
      } else {
        tile.classList.add("incorrect");
      }

      selectedCount++;
      if (selectedCount === 2) {
        tiles.forEach(t => t.classList.add("disabled"));
        document.getElementById("scoreInput").value = score;
        setTimeout(() => {
          document.getElementById("gameForm").submit();
        }, 800);
      }
    });
  });

  // Timer: automatischer Abbruch nach 8 Sekunden
  let timeLeft = 8;
  const timerEl = document.getElementById("timer");
  const countdown = setInterval(() => {
    timeLeft--;
    timerEl.textContent = `⏳ Zeit läuft... ${timeLeft}`;
    if (timeLeft <= 0 && selectedCount < 2) {
      clearInterval(countdown);
      tiles.forEach(t => t.classList.add("disabled"));
      document.getElementById("scoreInput").value = score;
      document.getElementById("gameForm").submit();
    }
  }, 1000);
</script>
{% endblock %}

