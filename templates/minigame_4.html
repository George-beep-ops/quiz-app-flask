{% extends 'base.html' %}

{% block title %}Minispiel 4 – Begriffe eingeben und Handy ablegen{% endblock %}

{% block content %}
  <h2>Minispiel 4</h2>
  <p>Gib die zwei Begriffe aus der Präsentation ein (getrennt mit Komma) und <strong>lege dein Handy innerhalb von 20 Sekunden waagerecht auf den Tisch</strong>.</p>

  <input type="text" id="inputField" placeholder="Begriffe eingeben..." style="padding: 1rem; font-size: 1rem; width: 80%; max-width: 400px; margin-bottom: 1rem;">
  <div id="status" style="margin-top: 1.5rem; font-weight: bold; color: green;">Zeit läuft...</div>

  <form method="POST" id="submitForm" style="display: none; margin-top: 1.5rem;">
    <input type="hidden" name="score" id="scoreInput" value="0">
    <button type="submit">Weiter</button>
  </form>
{% endblock %}

{% block script %}
<script>
  const correctAnswers = ["learning", "gamification"];
  let score = 0;
  let submitted = false;
  let flatDetected = false;

  function checkInput() {
    const input = document.getElementById("inputField").value.toLowerCase();
    const given = input.split(",").map(word => word.trim());
    score = 0;
    correctAnswers.forEach(answer => {
      if (given.includes(answer)) {
        score++;
      }
    });
  }

  function checkIfFlat(event) {
    const orientation = Math.abs(event.accelerationIncludingGravity.z);
    if (orientation > 9 && orientation < 10.5) {
      flatDetected = true;
      if (!submitted) {
        submitted = true;
        checkInput();
        document.getElementById("scoreInput").value = score;
        document.getElementById("submitForm").style.display = "block";
        document.getElementById("status").textContent = "✔️ Erfolgreich! Punkte werden übertragen.";
      }
    }
  }

  window.addEventListener("devicemotion", checkIfFlat);

  setTimeout(() => {
    if (!submitted && !flatDetected) {
      document.getElementById("status").textContent = "⏰ Zeit abgelaufen – Handy wurde nicht korrekt abgelegt.";
      document.getElementById("submitForm").style.display = "block";
    }
  }, 20000);
</script>
{% endblock %}

