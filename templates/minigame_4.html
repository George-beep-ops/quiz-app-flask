{% extends 'base.html' %}

{% block title %}Minispiel 4 – Begriffe und Bewegung{% endblock %}

{% block content %}
  <h2>Gib zwei Begriffe aus der Präsentation ein (getrennt mit Komma) und lege das Handy <strong>innerhalb von 20 Sekunden waagerecht</strong> auf den Tisch.</h2>

  <input type="text" id="inputField" placeholder="Begriffe eingeben..." style="padding: 1rem; font-size: 1rem; width: 80%; max-width: 400px; margin-bottom: 1rem;">
  <div id="status" style="font-weight: bold; margin: 1rem; font-size: 1.2rem;">⏳ Zeit läuft: <span id="timer">20</span>s</div>
  <div id="extra" style="font-weight: bold; font-size: 1.2rem; color: green;"></div>

  <form method="POST" id="submitForm" style="display: none;">
    <input type="hidden" name="score" id="scoreInput" value="0">
  </form>
{% endblock %}

{% block script %}
<script>
  const correctAnswers = ["learning", "gamification"];
  let score = 0;
  let submitted = false;
  let flatDetected = false;
  let timer = 20;

  const timerDisplay = document.getElementById("timer");
  const extraDisplay = document.getElementById("extra");

  const countdown = setInterval(() => {
    timer--;
    timerDisplay.textContent = timer;
    if (timer <= 0) {
      clearInterval(countdown);
      checkAndSubmit();
    }
  }, 1000);

  function checkInput() {
    const input = document.getElementById("inputField").value.toLowerCase();
    const given = input.split(",").map(word => word.trim());
    score = 0;
    correctAnswers.forEach(answer => {
      if (given.includes(answer)) {
        score++;
      }
    });
  }

  function checkIfFlat(event) {
    const orientation = Math.abs(event.accelerationIncludingGravity.z);
    if (orientation > 9 && orientation < 10.5 && !flatDetected) {
      flatDetected = true;
      extraDisplay.textContent = "✅ Zusatzpunkt!";
    }
  }

  window.addEventListener("devicemotion", checkIfFlat);

  function checkAndSubmit() {
    if (!submitted) {
      submitted = true;
      checkInput();
      if (flatDetected) {
        score += 1;
      }
      document.getElementById("scoreInput").value = score;
      document.getElementById("submitForm").submit();
    }
  }
</script>
{% endblock %}


