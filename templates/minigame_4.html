{% extends 'base.html' %}

{% block title %}Minispiel 4 – Begriffe eingeben{% endblock %}

{% block content %}
<h2>Welche Begriffe wurden in der Präsentation genannt?</h2>
<p>Gib zwei Begriffe ein (getrennt mit Komma) und lege dann das Handy waagerecht auf den Tisch!</p>
<input type="text" id="inputField" placeholder="Begriffe eingeben...">
<div id="status">⏳ Zeit läuft... <span id="timer">20</span>s</div>
<div id="extraPoint" style="color: green; font-weight: bold; font-size: 1.2rem; display: none;">+1</div>
{% endblock %}

{% block script %}
<script>
  const correctAnswers = ["learning", "gamification"];
  let score = 0;
  let extraPoint = false;
  let submitted = false;
  let timeLeft = 20;

  const inputField = document.getElementById("inputField");
  const status = document.getElementById("status");
  const timerDisplay = document.getElementById("timer");
  const extraPointDisplay = document.getElementById("extraPoint");

  function checkInput() {
    const input = inputField.value.toLowerCase();
    const given = input.split(",").map(word => word.trim());
    score = 0;
    correctAnswers.forEach(answer => {
      if (given.includes(answer)) score++;
    });
  }

  function sendResult() {
    if (submitted) return;
    if (extraPoint) score++;
    submitted = true;
    const form = document.createElement("form");
    form.method = "POST";
    form.style.display = "none";
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "score";
    input.value = score;
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
  }

  function checkIfFlat(event) {
    const z = Math.abs(event.accelerationIncludingGravity.z);
    if (z > 9 && z < 10.5 && !extraPoint && !submitted) {
      extraPoint = true;
      extraPointDisplay.style.display = "block";
    }
  }

  window.addEventListener("devicemotion", checkIfFlat);

  const countdown = setInterval(() => {
    timeLeft--;
    timerDisplay.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(countdown);
      checkInput();
      sendResult();
    }
  }, 1000);
</script>
{% endblock %}


