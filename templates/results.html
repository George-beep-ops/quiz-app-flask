{% extends 'base.html' %}

{% block title %}Ergebnisse{% endblock %}

{% block content %}
  <h2>Danke f√ºrs Mitmachen!</h2>
  <canvas id="rocketCanvas" width="400" height="400" style="margin-top: 2rem;"></canvas>
  <div id="scoreDisplay" data-score="{{ score | default(0) }}" style="font-size: 1.6rem; font-weight: bold; display: none; margin-top: 1.5rem;"></div>
  <div id="igniteText" style="font-size: 1.2rem; color: #444; margin-top: 1rem;">üß® Z√ºnde die Z√ºndschnur an!</div>
{% endblock %}

{% block script %}
<script>
const canvas = document.getElementById("rocketCanvas");
const ctx = canvas.getContext("2d");
const scoreDisplay = document.getElementById("scoreDisplay");
const igniteText = document.getElementById("igniteText");
const score = Number(scoreDisplay.dataset.score);

let isIgnited = false;
let fuseLength = 100;
let rotation = 0;
let explosionStarted = false;
let particles = [];

canvas.addEventListener("click", () => {
  if (!isIgnited) {
    isIgnited = true;
    igniteText.textContent = "üî• Z√ºndschnur brennt...";
    burnFuse();
  }
});

function burnFuse() {
  const burnInterval = setInterval(() => {
    fuseLength -= 2;
    if (fuseLength <= 0) {
      clearInterval(burnInterval);
      igniteText.textContent = "üí• Boom!";
      setTimeout(() => {
        explosionStarted = true;
        scoreDisplay.textContent = `Du hast ${score} Punkte erreicht! üëç`;
        scoreDisplay.style.display = "block";
      }, 1200);
    }
  }, 100);
}

function drawBeeKreisel() {
  ctx.save();
  ctx.translate(canvas.width / 2, canvas.height / 2);
  ctx.rotate(rotation);

  // K√∂rper
  ctx.fillStyle = "#f4c542";
  ctx.beginPath();
  ctx.ellipse(0, 0, 40, 20, 0, 0, Math.PI * 2);
  ctx.fill();

  // Streifen
  ctx.strokeStyle = "#000";
  ctx.lineWidth = 6;
  ctx.beginPath();
  ctx.moveTo(-25, -10);
  ctx.lineTo(-25, 10);
  ctx.moveTo(0, -12);
  ctx.lineTo(0, 12);
  ctx.moveTo(25, -10);
  ctx.lineTo(25, 10);
  ctx.stroke();

  // Fl√ºgel
  ctx.fillStyle = "#ccc";
  ctx.beginPath();
  ctx.ellipse(-15, -25, 10, 20, 0, 0, Math.PI * 2);
  ctx.ellipse(15, -25, 10, 20, 0, 0, Math.PI * 2);
  ctx.fill();

  // Z√ºndschnur
  if (!explosionStarted) {
    ctx.strokeStyle = "#ff0000";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, 20);
    ctx.lineTo(0, 20 + fuseLength);
    ctx.stroke();
  }

  ctx.restore();
}

function createParticles() {
  for (let i = 0; i < 100; i++) {
    const angle = Math.random() * 2 * Math.PI;
    const speed = Math.random() * 5 + 2;
    particles.push({
      x: canvas.width / 2,
      y: canvas.height / 2,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      alpha: 1,
      color: `hsl(${Math.random() * 360}, 100%, 50%)`
    });
  }
}

function drawParticles() {
  particles.forEach(p => {
    ctx.fillStyle = `rgba(255, 165, 0, ${p.alpha})`;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 4, 0, 2 * Math.PI);
    ctx.fill();
    p.x += p.vx;
    p.y += p.vy;
    p.alpha -= 0.02;
  });
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!explosionStarted) {
    drawBeeKreisel();
    if (isIgnited) rotation += 0.1;
  } else {
    if (particles.length === 0) {
      createParticles();
    }
    drawParticles();
  }

  requestAnimationFrame(animate);
}

animate();
</script>
{% endblock %}



