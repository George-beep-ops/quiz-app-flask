{% extends "base.html" %}

{% block title %}Minispiel 2 – Gefahr erkennen{% endblock %}

{% block extra_style %}
<style>
  .game-wrapper {
    margin-top: 1rem;
    height: 60vh;
    width: 100%;
    position: relative;
    overflow: hidden;
    background-color: #f0f0f0;
    border-radius: 10px;
    border: 2px solid #ccc;
  }

  .word-tile {
    position: absolute;
    padding: 0.6rem 1rem;
    font-size: 1rem;
    font-weight: bold;
    background-color: #e0e0e0;
    border-radius: 8px;
    white-space: nowrap;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .word-tile.correct {
    background-color: #90ee90 !important;
  }

  .word-tile.incorrect {
    background-color: #ffcccb !important;
  }
</style>
{% endblock %}

{% block content %}
<h2>Was ist eine mögliche Gefahr bei Gamification? Wähle bitte <strong>drei passende Begriffe!</strong></h2>

<form method="POST" id="submitForm">
  <input type="hidden" name="score" id="scoreInput" value="0">
  <div class="game-wrapper" id="gameArea"></div>
</form>
{% endblock %}

{% block script %}
<script>
  const gameArea = document.getElementById("gameArea");

  const words = [
    "zu wenige spiele", "zu viele spiele", "ablenkung",
    "einsamkeit", "traurigkeit", "bedauern"
  ];

  const correct = [
    "zu wenige spiele", "einsamkeit", "traurigkeit", "bedauern"
  ];

  let score = 0;
  let selectedCount = 0;

  // Erzeuge Kacheln mit Bewegung
  words.forEach(word => {
    const tile = document.createElement("div");
    tile.className = "word-tile";
    tile.textContent = word;
    gameArea.appendChild(tile);

    // zufällige Startposition
    let x = Math.random() * (gameArea.clientWidth - 120);
    let y = Math.random() * (gameArea.clientHeight - 40);
    let dx = (Math.random() - 0.5) * 2;
    let dy = (Math.random() - 0.5) * 2;

    tile.style.left = x + "px";
    tile.style.top = y + "px";

    function animate() {
      x += dx;
      y += dy;

      // Bounce an Kanten
      if (x <= 0 || x >= gameArea.clientWidth - tile.offsetWidth) dx *= -1;
      if (y <= 0 || y >= gameArea.clientHeight - tile.offsetHeight) dy *= -1;

      tile.style.left = x + "px";
      tile.style.top = y + "px";

      if (selectedCount < 3) requestAnimationFrame(animate);
    }

    animate();

    tile.addEventListener("click", () => {
      if (tile.classList.contains("correct") || tile.classList.contains("incorrect")) return;

      if (correct.includes(word)) {
        tile.classList.add("correct");
        score++;
      } else {
        tile.classList.add("incorrect");
      }

      selectedCount++;
      if (selectedCount === 3) {
        document.getElementById("scoreInput").value = score;
        setTimeout(() => {
          document.getElementById("submitForm").submit();
        }, 500);
      }
    });
  });
</script>
{% endblock %}
