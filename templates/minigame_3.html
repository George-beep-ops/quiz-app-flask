{% extends 'base.html' %}

{% block title %}Minispiel 3 – Schütteln{% endblock %}

{% block content %}
<h2>Schüttle das Handy bei „richtig“ – aber Vorsicht vor falschen Begriffen!</h2>
<div id="wordBox">Bereit?</div>
<div id="status"></div>
{% endblock %}

{% block script %}
<script>
  const words = ["falsch", "richtig", "falsch", "nein", "ja aber nein", "richtig"];
  let wordBox = document.getElementById("wordBox");
  let status = document.getElementById("status");
  let currentWord = "";
  let index = 0;
  let score = 0;
  let shakes = 0;
  let lastShake = 0;

  function showNextWord() {
    if (index >= words.length || shakes >= 2) return;
    currentWord = words[index];
    wordBox.textContent = currentWord;
    wordBox.style.backgroundColor = "white";
    index++;
    setTimeout(showNextWord, 2000);
  }

  function detectShake(event) {
    const now = new Date().getTime();
    if (now - lastShake < 1000) return;

    const acc = event.accelerationIncludingGravity;
    const total = Math.abs(acc.x) + Math.abs(acc.y) + Math.abs(acc.z);

    if (total > 25) {
      lastShake = now;
      if (currentWord === "richtig") {
        score++;
        wordBox.style.backgroundColor = "lightgreen";
      } else {
        score--;
        wordBox.style.backgroundColor = "#ff7777";
      }
      shakes++;
      if (shakes >= 2) {
        sendScoreAndExit();
      }
    }
  }

  function sendScoreAndExit() {
    const form = document.createElement("form");
    form.method = "POST";
    form.style.display = "none";
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "score";
    input.value = score;
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
  }

  if (window.DeviceMotionEvent) {
    window.addEventListener("devicemotion", detectShake);
  } else {
    alert("Dein Gerät unterstützt keine Bewegungserkennung.");
  }

  setTimeout(showNextWord, 1000);
</script>
{% endblock %}

